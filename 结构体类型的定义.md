#### 结构体类型的定义

　　C 语言允许用户自定义数据类型，典型的代表就是结构体，结构体类型和数组一样，都属于构造数据类型。它们之间的不同点就在于，数组是将相同类型的数据单独放在一起来存储，而结构体允许逻辑上相关，但类型不同的数据放在一起来存储。

　　例如：编写一个学生信息管理的程序，学生学号、姓名、性别、出生年月、成绩等数据都是与某一学生紧密联系的整体。我们不能将每个学生的学号、姓名、性别、出生年月、成绩等这些信息拆开来，分别用多个不同类型的数组来表示，就好比是将多台机器设备的零部件，拆下来分开入库一样，我们希望每台机器都能够作为一个独立的整体来单独存储，就要用到结构体类型。

　　这是定义一个结构体类型的一般形式：

```c
struct 结构体类型名
{  
    类型说明符1  成员名1;  
    类型说明符2  成员名2; 
    ……  
    类型说明符n  成员名n;
};
```

　　“结构体类型名”与“成员名”都遵循标识符命名规则。例如，定义一个学生数据类型：

```c
struct stu
{  
    int num; 
    char name[20];  
    char sex; 
    float score;
};
```

　　**注意**：结构体类型定义的末尾必须有分号。在上述`struct stu`结构体类型定义中，所有的成员都是基本数据类型或数组类型，成员也可以是一个结构体类型。例如下面结构体类型的定义：

```c
struct date
{ 
    int year;  
    int month;  
    int day;
};
struct stu
{  
    int num; 
    char name[20]; 
    char sex; 
    struct date birth; 
    float score;
};
```

　　一个结构体也可以嵌套在另一个结构体内部，像这种在一个结构体内又包含了另外一个结构体，作为其成员的结构体，我们就称它为是**嵌套的结构体**。

　　像 `int`、`float`、`char`、`double` 等是由 C 语言本身提供的数据类型，不能再进行分拆，我们称之为**基本数据类型**；而结构体可以包含多个基本类型的数据，也可以包含其他的结构体，我们将它称为复杂数据类型或**构造数据类型**。

#### 结构体类型所占内存的字节数

　　我们可以根据实际问题的需要来定义类型，把一组逻辑上相关的信息作为一个整体来处理。那么，如何计算结构体类型占用内存的字节数呢？结构体中的成员可以是不同的数据类型，成员按照定义时的顺序依次存储在连续的内存空间。 　数组占内存的字节数是所有数组元素占内存的字节数简单的相加。 　结构体是不是和数组一样，结构体类型占内存的字节数，是不是它的所有成员占内存字节数的总和呢？计算类型占内存的字节数不能想当然，而是应该用`sizeof`来获取，也就是用`sizeof`来获得一个类型或变量所占内存的字节数。

#### 结构体变量及结构体指针变量的定义

　　**结构体类型**和**结构体变量**是两个不同的概念，不能混淆。结构体类型只能表示一个结构形式，编译系统并不对它分配内存空间。只有当某变量被定义为这种类型的变量时，系统才为该变量分配存储空间。 　定义结构体类型变量有以下三种方法，以定义的 struct stu 为例来加以说明。

1. 先定义结构体类型，再定义结构体类型的变量。例如：

```c
struct stu            //定义struct stu类型
{  
    int num; 
    char name[20];  
    char sex; 
    float score;
};                   
struct stu s1,s2;      //定义struct stu类型的两个变量s1和s2
```

1. 在定义结构体类型的同时定义结构体类型的变量。例如：

```c
struct stu
{ 
    int num;
    char name[20]; 
    char sex; 
    float score;
}s1,s2;
```

1. 直接定义结构体变量。例如：

```c
struct
{  
    int num; 
    char name[20]; 
    char sex; 
    float score;
}s1,s2;
```

　　第三种方法与第二种方法的区别在于，第三种方法中省去了结构体类型名，而直接给出结构变量。

#### 结构体指针变量的定义

　　当一个指针变量用来指向一个结构体变量时，称之为结构体指针变量。结构体指针变量定义的一般形式为：

```c
struct 结构名 *结构体指针变量名
```

　　例如，在前面定义了`struct stu`这个结构体类型后，如要定义一个指向`struct stu`类型变量的指针变量`pstu`，可写为：

```c
struct stu *pstu,st;
pstu = &st;
```

　　`st`是被定义为`struct stu`类型的结构体变量，`pstu`是被定义为指向`struct stu`类型变量的指针变量，与前面讨论的各类指针变量相同，基类型为结构体的指针变量也必须要先赋值后才能使用。

#### 结构体变量的使用及初始化

　　结构体变量的使用，是指赋值、输入、输出、运算等，一般是通过引用结构体变量的成员来实现的，有下面 4 种情形：

1. 使用成员运算符引用结构体变量的成员。例如：

```c
struct stu s1,s2;
s1.num = 10010;
strcpy(s1.name, "zhangsan");
s1.sex = 'm';
s1.score = 84.5;
scanf("%d", &(s2.num));
scanf("%s", s2.name);
scanf(" %c",&(s2.sex));
scanf("%f",&(s2.score));
```

　　**注意**：结构体变量`s1`的值是通过赋值语句得到的，结构体变量`s2`的值是从键盘输入的，若连续输入两个字符或者先输入一个字符串后输入一个字符，则输入第二个字符的控制符`%c`前应加一个空格。如语句`scanf(" %c",&(s2.sex))`中，格式控制符`%c`之前的空格不能省略，否则，两次输入之间的分隔符将被作为第二个字符的输入加以处理。请思考如何输出`s1`,`s2`的值。

1. 使用指针运算符和成员运算符引用结构体变量的成员。例如:

```c
  struct stu s,*p = &s; 
(*p).num = 10010;  
strcpy((*p).name,"zhangsan"); 
(*p).sex = 'm';  
(*p).score=84.5;
```

　　应该注意`(*p)`两侧的括号不可少，因为成员符`.`的优先级高于`*`。如去掉括号写作`*p.num`则等效于`*(p.num)`，这样，意义就完全不对了。

1. 使用指向运算符“->”引用结构体变量的成员。例如:

```c
struct stu s,*p = &s; 
scanf("%d", &(p->num));;  
scanf("%s", p->name);
scanf(" %c", p->sex); 
scanf("%f",&p->score);
```

**注意：**

- 成员运算符`.`与指向运算符`->`的优先级相同，都高于指针运算符`*`。

- 不能将结构体变量当作一个整体进行输入、输出，但可以或将结构体变量作为一个整体，在结构体变量之间进行赋值，此时系统将按成员一一对应赋值。例如:

  ```c
  struct stu s1,s2;
  s1.num = 10010;
  strcpy(s1.name, "zhangsan");
  s1.sex='m';
  s1.score=84.5;
  s2 = s1;    
  ```

- 如果成员本身又是一个结构体类型，则必须逐级找到最低级的成员才能使用。如`s1.birth`，即上述结构体变量`s1`的`birth`成员的`month`成员可以在程序中作为`int`型类型单独使用，与普通`int`型变量完全相同。例如：

  ```c
  s1.birth.year = 2000; 
  s1.birth.month = 3; 
  s1.birth.day = 14; 
  ```

- 结构体变量的初始化，和其他类型变量一样，结构体变量可以在定义时进行初始化赋值。

```c
struct stu  
{  
    int num;  
    char name[20]; 
    char sex; 
    float score;
};
struct stu s={10010,"Zhangsan",'M',84.5}; 
```



> Ｃ 语言不仅提供了丰富的数据类型，而且还允许由用户自己定义类型说明符，也就是说允许用户为数据类型取“别名”，通过类型定义符`typedef`即可完成此功能。下面，来看一下几个类型定义符`typedef`的使用方法举例。

1）现有整型量`a`、`b`，定义如下：

```c
int a,b;
```

其中`int`是整型变量的类型说明符。`int`的完整写法为`integer`，为了增加程序的可读性，可把整型说明符用`typedef`定义为：

```c
typedef int INTEGER;
```

这以后就可用`INTEGER`来代替`int`作整型变量的类型说明了。 例如：

```c
INTEGER a,b;
```

它等效于：

```c
int a,b;
```

用`typedef`定义数组、指针、结构体等类型将带来很大的方便，不仅使程序书写简单而且使意义更为明确，因而增强了可读性。

2）现有字符数组`a1`、`a2`、`s1`，定义如下： 

```c
char a1[20],a2[20],s1[5][20];
```

可把长度为`20`的字符数组用`typedef`定义为：   

```c
typedef char NAME[20];
```

这以后就可用`NAME`表示数组长度为`20`的字符数组类型。用`NAME` 定义变量和数组，如：

```c
NAME a1,a2,s1[5];
```

完全等效于：

```c
char a1[20],a2[20],s1[5][20];
```

3）有函数的指针`p1`,`p2`定义如下：

```c
int (*p1)(char [],int );
int (*p2)(char [],int);
```

用`typedef`定义如下：

```c
typedef int (*Pointer)( char [],int);
```

这以后就可用`Pointer`同时定义多个同类型的函数指针变量。如下：

```c
Pointer  p1,p2;
```

完全等效于：

```c
int (*p1)(char [],int);int (*p2)(char [],int);
```

4）现有结构体类型和结构体类型变量`a`、`b`、`c`，定义如下：

```c
struct stu             //定义 struct stu的结构类型
{ 
    int num;  
    char name[20]; 
    char sex; 
    float score;};  
struct stu  a,b,c;      //定义 struct stu的结构类型的变量a,b,c
```

用`typedef `定义`struct stu` 的别名如下：

```c
typedef   struct stu   student;
```

这以后就可用`student`表示`struct stu`类型。用`student` 说明变量，如：

```c
student a,b,c;
```

完全等效于：

```c
struct stu  a,b,c;
```

进一步可以将定义结构体类型和为结构体类型取别名合二为一，如下：

```c
typedef struct stu
{  
    int num; 
    char name[20]; 
    char sex; 
    float score;} student;
```

此时，`student`为结构体类型`struct stu`的别名。

使用`typedef`时，应注意以下三点：

- 用`typedef`只是对已经存在的类型指定一个新的类型名，而没有创造新的类型；
- 用`typedef`定义数组类型、指针类型，结构体类型、共用体类型、枚举类型等类型的别名，使得编程更加方便；
- 使用`typedef`名称有利于程序的通用与移植。有时程序会依赖于硬件特性，用`typedef`类型便于移植。



如果有一批学生的数据需要处理，可以定义结构体数组，即数组的每一个元素都是具有相同结构体类型的下标结构体变量。在实际应用中，经常用结构体数组来表示具有相同数据结构的一个群体，如一个班的学生档案、一个车间职工的工资表等。结构体数组的定义方法和结构变量相似，只需说明它为数组类型即可。

定义学生数据类型如下：

```c
typedef struct date
{
    int year;   
    int month;   
    int day;
}DATE;
typedef struct student
{   
    int num;    
    char name[20];  
    char sex;    
    DATE birthday;  
    float score;
}STUDENT;
```

定义长度为`5`的结构体数组如下：

```c
STUDENT b[5];
```

这个结构体数组`b`，共有`5`个元素，依次为`b[0]`～`b[4]`，每个数组元素都是`STUDENT`类型，数组`b`可以存放`5`个学生的数据。

结构体数组还可以在定义时初始化如下：

```c
STUDENT b[5]={                 
                {10010,"Liyi",’M’,2000,5,23,45},                 
                {10020,"Lier",’M’,2001,2,3,62.5},                 
                {10030,"Lisan",’F’,2000,10,14,92.5},                 
                {10040,"Lisi",’F’,2002,7,23,87},                 
                {10050,"Liwu",’M’,1999,8,6,58};
};
```

结构体数组定义时就进行初始化，也可不给出数组长度，编译系统会自动根据初值的个数决定数组的长度。

如果定义了针对`STUDENT`类型的变量输入输出函数如下：

```c
void input(STUDENT *s);
void output(STUDENT s);
```

那么，可以按下面格式输入输出结构体数组元素的值：

```c
for(i=0;i<5;i++)
{   
    input(&b[i]);
}
for(i=0;i<5;i++)
{    
    output(b[i]);
}
```

如果要定义针对`STUDENT`类型的数组输入输出函数，函数的原型参考如下：

```c
void inputarr(STUDENT s[ ], int n);
void outputarr(STUDENT s[ ], int n);
```